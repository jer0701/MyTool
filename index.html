<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Package</title>
    <style type="text/css">
      html,body{margin:0;padding:0;}
      .left {width: 250px;height: 900px;float: left;overflow: scroll;overflow-x:hidden}
      .right{margin-left:258px}
      .right .wrap{padding-top: 22px;}
      .box{margin-bottom:15px;}
      label{display:inline-block;width: 250px;margin-right: 25px;margin-bottom: 10px;}
      input{font-size:16px;text-indent:4px;}
      button{width:130px;height:34px;text-align:center;line-height:34px;font-size:16px;margin-right:10px;cursor:pointer;}
      textarea{width:60%;height:384px;}
      p{padding:20px;color:#ff0000;font-size:20px;}

      .selectFile {display:block;margin-top: -15px;width: 170px;}
      .Dir{margin-top: -15px;}
      #preCheck{width:128px;display:inline-block;height:32px;text-align:center;line-height:32px;font-size:16px;text-decoration:none;list-style-type:none;color:#ff0000;border:1px solid rgb(169, 169, 169);background-color:#ececec;margin-left:1px;vertical-align:3px;}
      .path{display: none;}
      
    </style>
    <script src="js/jquery-1.7.2.min.js"></script>
  </head>
  <body>
    <div class="left">
          <h3>
            选择需要打包的目录：
          </h3>
          <button class="selectFile">选择文件</button>
          <div class="box Dir">
            <!-- <label><input name="path" type="radio" value="2017-08/2017-08-09-818" />2017-08/2017-08-09-818 </label> -->
          </div>
    </div>
    <div class="right">
        <div class="wrap">
          <div class="box">  
            <button id="pcp">PC打包</button>
            <button id="mbp" >MBP打包</button>
            <button id="mbb">MBB恢复</button> 
          </div>
          <div class="box">
            <button id="copy" >复制代码</button>
            <button id="clear">清空</button> 
            <a href="zt" target="_blank" id="preCheck">预览PC</a>
          </div>
          <pre>﻿<textarea id="copy-content"></textarea></pre>
          <p></p>
        </div>
    </div>

    <script type="text/javascript">
      // You can also require other files to run in this process
      var getFileDir = require('./renderer.js');
      var pcp = require('./package/pcp.js');

      //普通数组快速排序算法
      function swap(myArray, p1, p2) {
        var temp = myArray[p1];
        myArray[p1] = myArray[p2];
        myArray[p2] = temp;
      }

      function position(myArray, left, right){
        var pivot = myArray[right];
        var tail = left - 1; 

        for(var i = left; i < right; i++) { 
          if(myArray[i] > pivot) {
            tail++;
            swap(myArray, tail, i);
          }
        }
        swap(myArray, tail+1, right);
        return tail+1;
      }

      function quickSort(myArray, left, right) {
        if(myArray.length < 2){
          return myArray;
        }

        left = (typeof left !== "number" ? 0 : left);
        right = (typeof right !== "number" ? myArray.length-1 : right);

        var index = position(myArray, left, right);

        if(left < index - 1) {
                quickSort(myArray, left, index - 1);
          }

        if(index < right) {
              quickSort(myArray, index + 1, right);
          }


        return myArray;
      }

      //fileDir数组快速排序
      function positionJSON(myArray, left, right){
        var pivot = myArray[right].ctime; 
        var tail = left - 1; 

        for(var i = left; i < right; i++) { 
          if(myArray[i].ctime > pivot) {  //根据ctime创建时间排序
            tail++;
            swap(myArray, tail, i);
          }
        }
        swap(myArray, tail+1, right);  
  　　　　　　　　　　　　　　　　
        return tail+1;
      }

      function quickSortJSON(myArray, left, right) { 
        if(myArray.length < 2){
          return myArray;
        }

        left = (typeof left !== "number" ? 0 : left);
        right = (typeof right !== "number" ? myArray.length-1 : right);

        var index = positionJSON(myArray, left, right);

        if(left < index - 1) {
                quickSortJSON(myArray, left, index - 1);
          }

        if(index < right) {
              quickSortJSON(myArray, index + 1, right);
          }


        return myArray;
      }


      //数组去重
      var uniqueArr = function(Arr) {
        var result = [];
        for(var i = 0;i < Arr.length; i++){
            if(result.indexOf(Arr[i]) === -1){
                result.push(Arr[i]);
            }
        }
         return result;
      }

      var initFileDir = function() {
        getFileDir(function(fileDir){
          if(!fileDir) return;

          //给data数组按照创建时间从最近到最远排列
          var data = quickSortJSON(fileDir);
          //$('textarea').text(data[0].dir);
                
          var length = data.length;
          if(!length) return;
                 
          //获取文件夹创建的年份和月份（通过文件夹的命名来获取）
          var yearArr = [];
          var monthArr = [];
          for (var i = 0; i < length; i++) {
            var dirName = data[i].dir.split("\\");
            var dir = dirName[0].split("-");
            yearArr.push(dir[0]);
            monthArr.push(dir[1]);
                      
          }

          yearArr = quickSort(uniqueArr(yearArr));
          monthArr = quickSort(uniqueArr(monthArr));
          //console.log(monthArr);


          var markM = 0; //月份标记位 1表示新的月份 0表示旧的月份
          for(var y = 0, ylen = yearArr.length; y < ylen; y++) {
            for(var m = 0, mlen = monthArr.length; m < mlen; m++) {
              for (var i = 0; i < length; i++) {
                if(i == 0) { //重新开始循环，那么必然是进入新的月份
                  markM = 1;
                }

                var value = data[i].dir.split("\\"); 
                var dirPath = value[0].split("-");
                //console.log(value);
                if (dirPath[0] != yearArr[y]) continue;
                if (dirPath[1] != monthArr[m]) continue;

                if (markM) { //新的月份
                  markM = 0;
                  $(".Dir").append("<br><i>"+dirPath[0]+"-"+dirPath[1]+":"+"</i>");
                } 
                if( i % 2 == 0 ) {
                  $(".Dir").append("<br>");
                }

                $(".Dir").append("<label><input name='path' type='radio' value='" + value[1] + "' />"+ value[1] +"<span class='path'>"+ data[i].path +"</span></label>");                    

              }

            }

          }

        });
        
      };

      var init = function() {
        $(".selectFile").bind("click", initFileDir);
        //pcp打包
        $("#pcp").bind("click", function(event) {
            /* Act on the event */
            var value  = $('input[name="path"]:checked').val();
            
            if (value) {
              var $span = $('input[name="path"]:checked').siblings();
              console.log($span.text());
              pcp($span.text());

            } else {
              alert("请先选择需要打包的目录");
            }
        });
      }

      $(function () {

          init();

      })

    </script>
  </body>
</html>